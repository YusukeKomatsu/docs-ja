<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="reference">
<meta name="description" content="To limit the number of simultaneous view request on a server node, use the &gt;POST /internalSettings HTTP method and URI and a port-related request parameter."><meta name="DC.Relation" scheme="URI" content="../REST/rest-views-intro.html">
<meta name="DC.Relation" scheme="URI" content="../REST/rest-views-get.html">
<meta name="DC.Relation" scheme="URI" content="rest-bucket-intro.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rest-views-requests">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Limiting views requests</title>
</head>
<body id="rest-views-requests">


  <h1 class="title topictitle1">Limiting views requests</h1>

  
  <div class="body refbody"><p class="shortdesc">To limit the number of simultaneous view request on a server node, use the <samp class="ph codeph">&gt;POST /internalSettings</samp> HTTP method and URI 
    and a port-related request parameter.</p>

    
    <div class="section"><h2 class="title sectiontitle">Description</h2>
      <p class="p">Couchbase Server provides limits to incoming connections on a server node. 
        The limits are to prevent the server from becoming overwhelmed. 
        When a limit is exceeded, the server rejects the incoming connection, 
      responds with a 503 HTTP status code, and sets the HTTP Retry-After header.</p>

      <ul class="ul">
        <li class="li">If the request is made to a REST port, the response body provides the
          reason for the rejection.</li>

        <li class="li">If the request is made on a CAPI port, such as a views
          request, the server responds with a JSON object with error and reason fields.</li>

      </ul>

    </div>

    
    <div class="section"><h2 class="title sectiontitle">HTTP method and URI</h2>
      <pre class="pre codeblock">POST /internalSettings</pre>

      
      
      <p class="p">Parameters:</p>

      <p class="p">The following are port-related request parameters:</p>

      <p class="p">By default, these settings do not have a limit. </p>

      <ul class="ul">
        <li class="li">restRequestLimit
          <p class="p">Maximum number of simultaneous connections each server node accepts on a REST port. 
            Diagnostic-related requests and&nbsp;<samp class="ph codeph">/internalSettings</samp> requests are not counted in this limit.</p>
</li>

        <li class="li">capiRequestLimit
          <p class="p">Maximum number of simultaneous connections each server node accepts on a CAPI port. 
            This port is used for XDCR and views connections.</p>
</li>

        <li class="li">dropRequestMemoryThresholdMiB
          <p class="p">Value in MB. The maximum amount of memory that is used by Erlang VM. 
            If the amount is exceeded, the server starts dropping incoming connections.</p>
</li>

      </ul>


        <div class="note important"><span class="importanttitle">Important:</span> Keep the default setting unless you experience issues with too many requests impacting a node. 
        If these thresholds are set too low, too many requests are rejected by the server, 
        including requests from the Couchbase web console.</div>

    </div>

    
    <div class="section"><h2 class="title sectiontitle">Syntax</h2>
      <p class="p">Curl request syntax:</p>

      <pre class="pre codeblock">curl -X POST -u [admin]:[password]
  http://[localhost]:8091/internalSettings 
  -d capiRequestLimit=[value]
</pre>


    </div>

    
    <div class="section"><h2 class="title sectiontitle">Example</h2>
      <p class="p">Curl request example:</p>

      <p class="p">The following example limits the number of simultaneous views requests and internal XDCR requests which can be made on a port.</p>

      <pre class="pre codeblock">curl -X POST -u Administrator:password 
  http://10.5.2.117:8091/internalSettings 
  -d capiRequestLimit=50
  -d restRequestLimit=50
</pre>


    </div>

    
    <div class="section"><h2 class="title sectiontitle">Response</h2>
      <p class="p">No response is returned with a curl request changing the rest or capi request limit.  
      Retrieve the internal settings to see changes.</p>

      
      <p class="p">The following example retrieves and shows the internal settings with the rest and capi request limits set to 50:</p>

      <pre class="pre codeblock">curl -u Administrator:password http://10.5.2.117:8091/internalSettings
        
        
{
    "capiRequestLimit": 50, 
    "dropRequestMemoryThresholdMiB": "", 
    "indexAwareRebalanceDisabled": false, 
    "maxBucketCount": 10, 
    "maxParallelIndexers": 6, 
    "maxParallelReplicaIndexers": 2, 
    "rebalanceIgnoreViewCompactions": false, 
    "rebalanceIndexPausingDisabled": false, 
    "rebalanceIndexWaitingDisabled": false, 
    "rebalanceMovesBeforeCompaction": 64, 
    "rebalanceMovesPerNode": 1, 
    "restRequestLimit": 50, 
    "xdcrAnticipatoryDelay": 0, 
    "xdcrCheckpointInterval": 1800, 
    "xdcrDocBatchSizeKb": 2048, 
    "xdcrFailureRestartInterval": 30, 
    "xdcrMaxConcurrentReps": 32, 
    "xdcrOptimisticReplicationThreshold": 256, 
    "xdcrWorkerBatchSize": 500
}
      </pre>

    </div>


    
  </div>

  
  <nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../REST/rest-views-intro.html" title="The Views REST API is used to index and query JSON documents.">Views API</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../REST/rest-views-get.html" title="To retrieve views information, access any server node in a cluster on port 8092.">Getting views information</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="rest-bucket-intro.html" title="The Buckets REST API creates, deletes, flushes, and retrieves information about buckets and bucket operations.">Buckets API</a></div></div>
</nav>
  

</body>
</html>