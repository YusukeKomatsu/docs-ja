<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="reference">
<meta name="description" content="The cbtransfer tool is used to transfer data between clusters and to/from files."><meta name="DC.Relation" scheme="URI" content="../cli-intro.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbstats-intro.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbworkloadgen_tool.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cbtransfer-tool">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>cbtransfer tool</title>
</head>
<body id="cbtransfer-tool">


	<h1 class="title topictitle1">cbtransfer tool</h1>

	
	<div class="body refbody"><p class="shortdesc">The <samp class="ph codeph">cbtransfer</samp> tool is used to transfer data between clusters and
		to/from files. </p>

		<div class="section"><h2 class="title sectiontitle">Description</h2>
			
			<p class="p">In addition to transferring data between clusters and to/from files, the
					<samp class="ph codeph">cbtransfer</samp> tool can also be used create a copy of data from a
				node that no longer running. This tool is the underlying, generic data transfer tool
				that <samp class="ph codeph">cbbackup</samp> and <samp class="ph codeph">cbrestore</samp> are built upon. It is
				a lightweight extract-transform-load (ETL) tool that can move data from a source to
				a destination. The source and destination parameters are similar to URLs or file
				paths.</p>

			<div class="note note"><span class="notetitle">Note:</span> The most important way to use this tool is for transferring data from
				a Couchbase node that is no longer running to a cluster that is running. The
					<samp class="ph codeph">cbbackup</samp>, <samp class="ph codeph">cbrestore</samp>, and
					<samp class="ph codeph">cbtransfer</samp> tools do not communicate with external IP addresses
				for server nodes outside of a cluster. Backup, restore, or transfer operations are
				performed on data from a node within a Couchbase cluster. They only communicate with
				nodes from a node list obtained within a cluster. This also means that if Couchbase
				Server is installed with a default IP address, an external hostname cannot be used
				to access it.</div>

			<div class="note note"><span class="notetitle">Note:</span> Couchbase Server does not transfer design documents. To backup design
				document, use <samp class="ph codeph">cbbackup</samp> to store the information and
					<samp class="ph codeph">cbrestore</samp> to read it back into memory.</div>

			<p class="p">The tool is at the following location:</p>

			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
					
					
					<thead class="thead" align="left">
						<tr class="row">
							<th class="entry" valign="top" width="50%" id="d43904e72">Operating system</th>

							<th class="entry" valign="top" width="50%" id="d43904e75">Location</th>

						</tr>

					</thead>

					<tbody class="tbody">
						<tr class="row">
							<td class="entry" valign="top" width="50%" headers="d43904e72 ">Linux</td>

							<td class="entry" valign="top" width="50%" headers="d43904e75 ">/opt/couchbase/bin/</td>

						</tr>

						<tr class="row">
							<td class="entry" valign="top" width="50%" headers="d43904e72 ">Windows</td>

							<td class="entry" valign="top" width="50%" headers="d43904e75 ">C:\Program&nbsp;Files\Couchbase\Server\bin\</td>

						</tr>

						<tr class="row">
							<td class="entry" valign="top" width="50%" headers="d43904e72 ">Mac OS X</td>

							<td class="entry" valign="top" width="50%" headers="d43904e75 ">/Applications/Couchbase&nbsp;Server.app/Contents/Resources/couchbase-core/bin/</td>

						</tr>

					</tbody>

				</table>
</div>

		</div>

		
		<div class="section"><h2 class="title sectiontitle">CLI command and parameters</h2>
			
		<p class="p">Basic syntax for this command:</p>

		<pre class="pre codeblock">cbtransfer [options] source destination</pre>

		<p class="p">The following are the command options:</p>

		
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. cbtransfer options</span></caption>
				
				
				<thead class="thead" align="left">
					<tr class="row">
						<th class="entry" valign="top" width="50%" id="d43904e141">Parameters</th>

						<th class="entry" valign="top" width="50%" id="d43904e144">Description</th>

					</tr>

				</thead>

				<tbody class="tbody">
					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-h, –help</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Command line help.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-b BUCKET_SOURCE</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Single named bucket from source cluster to transfer.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-B BUCKET_DESTINATION, –bucket-destination=BUCKET_DESTINATION</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Single named bucket on destination cluster which receives transfer. This enables you to
							transfer to a bucket with a different name as your source bucket. If you
							do not provide defaults to the same name as the bucket-source.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-i ID, –id=ID</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Transfer only items that match a vbucket ID.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-k KEY, –key=KEY</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Transfer only items with keys that match a regexp.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-n, –dry-run</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">No actual transfer; just validate parameters, files, connectivity and
							configurations.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-u USERNAME, –username=USERNAME</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">REST username for source cluster or server node.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-p PASSWORD, –password=PASSWORD</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">REST password for cluster or server node.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-t THREADS, –threads=THREADS</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Number of concurrent workers threads performing the transfer. Default: 4.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-v, –verbose</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Verbose logging; provide more verbosity.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">-x EXTRA, –extra=EXTRA</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Provide extra, uncommon config parameters.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">–single-node</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Transfer from a single server node in a source cluster. This single server node is a
							source node URL.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">–source-vbucket-state=SOURCE_VBUCKET_STATE</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Only transfer from source vbuckets in this state, such as ‘active’
							(default) or ‘replica’. Must be used with Couchbase cluster as
							source.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">–destination-vbucket-state=DESTINATION_VBUCKET_STATE</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Only transfer to destination vbuckets in this state, such as ‘active’
							(default) or ‘replica’. Must be used with Couchbase cluster as
							destination.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 ">–destination-operation=DESTINATION_OPERATION</td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Perform this operation on transfer. “set” will override an existing
							document, ‘add’ will not override, ‘get’ will load all keys transferred
							from a source cluster into the caching layer at the destination.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e141 "><samp class="ph codeph">/path/to/filename</samp></td>

						<td class="entry" valign="top" width="50%" headers="d43904e144 ">Export a.csv file from the server or import a.csv file to the server.
						</td>

					</tr>

				</tbody>

			</table>
</div>

			<p class="p">The following are extra, specialized command options with the <samp class="ph codeph">cbtransfer -x</samp>
				parameter.</p>

			
			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 2. cbtransfer -x options</span></caption>
				
				
				<thead class="thead" align="left">
					<tr class="row">
						<th class="entry" valign="top" width="50%" id="d43904e323">-x options</th>

						<th class="entry" valign="top" width="50%" id="d43904e326">Description</th>

					</tr>

					
				</thead>

				<tbody class="tbody">
					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">backoff_cap=10</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Maximum backoff time during the rebalance period.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">batch_max_bytes=400000</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Transfer this # of bytes per batch.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">batch_max_size=1000</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Transfer this # of documents per batch.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">cbb_max_mb=100000</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Split backup file on destination cluster if it exceeds the MB.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">conflict_resolve=1</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">By default, disable conflict resolution.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">data_only=0</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">For value 1, transfer only data from a backup file or cluster.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">design_doc_only=0</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">For value 1, transfer only design documents from a backup file or cluster. Default: 0.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">max_retry=10</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Max number of sequential retries if the transfer fails.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">mcd_compatible=1</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">For value 0, display extended fields for stdout output.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">nmv_retry=1</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">0 or 1, where 1 retries transfer after a NOT_MY_VBUCKET message. Default: 1.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">recv_min_bytes=4096</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Amount of bytes for every TCP/IP batch transferred.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">rehash=0</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">For value 1, rehash the partition id's of each item. 
							This is required when transferring data between clusters with
							different number of partitions, such as when transferring data from an
							Mac OS X server to a non-Mac OS X cluster.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">report=5</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Number batches transferred before updating progress bar in console.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">report_full=2000</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Number batches transferred before emitting progress information in console.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">seqno=0</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">By default, start seqno from beginning.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">try_xwm=1</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">Transfer documents with metadata. Default: 1. Value of 0 is only used when transferring
								from 1.8.x to 1.8.x.</td>

					</tr>

					<tr class="row">
						<td class="entry" valign="top" width="50%" headers="d43904e323 ">uncompress=0</td>

						<td class="entry" valign="top" width="50%" headers="d43904e326 ">For value 1, restore data in uncompressed mode.</td>

					</tr>

				</tbody>

			</table>
</div>

		</div>

		
		<div class="section"><h2 class="title sectiontitle">Syntax</h2>
			<p class="p">The following is the basic syntax:</p>

			<pre class="pre codeblock">cbtransfer [options] source destination</pre>

			
			
			<p class="p">The following are syntax examples:</p>

			
			<pre class="pre codeblock">
cbtransfer http://SOURCE:8091 /backups/backup-42
cbtransfer /backups/backup-42 http://DEST:8091
cbtransfer /backups/backup-42 couchbase://DEST:8091
cbtransfer http://SOURCE:8091 http://DEST:8091
cbtransfer file.csv http://DEST:8091
			</pre>

		
		
		</div>

		
		<div class="section"><h2 class="title sectiontitle">Example: Transferring data to a cluster</h2>
			<p class="p">The following example and response transfers data from a non-running node to a running cluster:</p>

			<p class="p">Syntax:</p>

			<pre class="pre codeblock">
cbtransfer
	couchstore-files://COUCHSTORE_BUCKET_DIR
	couchbase://HOST:PORT
	--bucket-destination=DESTINATION_BUCKET
			</pre>

       

<pre class="pre codeblock">cbtransfer
	couchstore-files:///opt/couchbase/var/lib/couchbase/data/default
	couchbase://10.5.3.121:8091
	--bucket-destination=foo
</pre>

		
			<p class="p">The response shows 10000 total documents transferred in batch size of 1088 documents each.</p>

		<pre class="pre codeblock">[####################] 100.0% (10000/10000 msgs)
bucket: bucket_name, msgs transferred...
      : total | last | per sec
batch : 1088 | 1088 | 554.8
byte : 5783385 | 5783385 | 3502156.4
msg : 10000 | 10000 | 5230.9
done
</pre>

		</div>

		
		<div class="section"><h2 class="title sectiontitle">Example: Transferring data to standard output</h2>
			<p class="p">The following example and response sends all the data from a node to standard output:</p>

		<pre class="pre codeblock">cbtransfer http://10.5.2.37:8091/ stdout:

set pymc40 0 0 10
0000000000
set pymc16 0 0 10
0000000000
set pymc9 0 0 10
0000000000
set pymc53 0 0 10
0000000000
set pymc34 0 0 10
0000000000
</pre>

		
		</div>

		
		
		<div class="section"><h2 class="title sectiontitle">Example: Exporting and importing CSV files</h2>
		<p class="p">The <samp class="ph codeph">cbtransfer</samp> tool is also used to import and export <samp class="ph codeph">csv</samp>
				files. Data is imported into Couchbase Server as documents and documents are
				exported from the server into comma-separated values. Design documents associated
				with vBuckets are not included.</p>

			<p class="p">In these examples, the following records are in the default bucket where re-fdeea652a89ec3e9
				is the document ID, 0 are flags, 0 is the expiration, and the CAS value is
				4271152681275955. The actual value is the hash starting with "{""key""....... </p>

		<pre class="pre codeblock">re-fdeea652a89ec3e9,
0,
0,
4271152681275955,
"{""key"":""re-fdeea652a89ec3e9"",
 ""key_num"":4112,
 ""name"":""fdee c3e"",
 ""email"":""fdee@ea.com"",
 ""city"":""a65"",
 ""country"":""2a"",
 ""realm"":""89"",
 ""coins"":650.06,
 ""category"":1,
 ""achievements"":[77, 149, 239, 37, 76],""body"":""xc4ca4238a0b923820d
 .......
""}"
......
</pre>

			<p class="p">This example exports these items to a .csv file. All items are transferred from the default
				bucket, <samp class="ph codeph">-b default</samp> available at the node
					<samp class="ph codeph">http://localhost:8091</samp> and put into the
					<samp class="ph codeph">/data.csv</samp> file. If a different bucket is provided for the
					<samp class="ph codeph">-b</samp> option, all items are exported from that bucket. Credentials
				are required for the cluster when exporting items from a bucket in the cluster. </p>

		<pre class="pre codeblock">cbtransfer http://[localhost]:8091 csv:./data.csv -b default -u Administrator -p password
</pre>

		
			<p class="p">The following example response is similar to that in other <samp class="ph codeph">cbtransfer</samp>
				scenarios:</p>

		<pre class="pre codeblock">[####################] 100.0% (10000/10000 msgs)
bucket: default, msgs transferred...
       : total | last | per sec
 batch : 1053 | 1053 | 550.8
 byte : 4783385 | 4783385 | 2502156.4
 msg : 10000 | 10000 | 5230.9
2013-05-08 23:26:45,107: mt warning: cannot save bucket design on a CSV destination
done
</pre>

		<p class="p">The following example syntax shows 1053 batches of data transferred at 550.8 batches per
				second. The tool outputs “cannot save bucket design….” to indicate that no design
				documents were exported. To import information from a.csv file to a named bucket in
				a cluster:</p>

		<pre class="pre codeblock">cbtransfer /data.csv http://[hostname]:[port] -B bucket_name -u Administrator -p password
</pre>

		<p class="p">If the .csv file is not correctly formatted, the following error displays during import:</p>

		<pre class="pre codeblock">w0 error: fails to read from csv file, .....
</pre>

			
		</div>

		
		
	</div>

<nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../cli-intro.html" title="Couchbase Server command-line interface (CLI) tools are provided to manage and monitor clusters, servers, vBuckets, XDCR, and so on.">CLI reference</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../CLI/cbstats-intro.html" title="The cbstats tool is used to get node and cluster-level statistics about performance and items in storage.">cbstats tool</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../CLI/cbworkloadgen_tool.html" title="The cbworkloadgen tool is used to generate random data and perform read/writes.">cbworkloadgen tool</a></div>
</div>
</nav>
</body>
</html>