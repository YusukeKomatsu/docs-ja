<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="topic">
<meta name="description" content="Couchbase Server provides statistics at multiple levels throughout the cluster."><meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-intro.html">
<meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-diskqueue.html">
<meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-moxi-statistics.html">
<meta name="DC.Relation" scheme="URI" content="../REST/overview-rest-api.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbstats-intro.html">
<meta name="DC.Relation" scheme="URI" content="http://github.com/membase/ep-engine/blob/master/docs/stats.org">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="topic3970">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Couchbase Server statistics</title>
</head>
<body id="topic3970">


  <h1 class="title topictitle1">Couchbase Server statistics</h1>

  
  <div class="body"><p class="shortdesc">Couchbase Server provides statistics at multiple levels throughout the cluster.</p>

    <p class="p">The statistics
      used for regular monitoring, capacity planning and to identify the performance characteristics
      of your cluster deployment. The most visible statistics are those in the Web UI, but
      components such as the REST interface, the proxy and individual nodes have directly accessible
      statistics interfaces.</p>

    <div class="section"><h2 class="title sectiontitle">REST interface statistics</h2><p class="p">To interact with statistics provided by
        REST, use the Couchbase web console. 
        This GUI gathers statistics via REST and displays them to your browser.
        The REST interface has a set of resources that provide access to the current and historic
        statistics the cluster gathers and stores.</p>
</div>

    
    <div class="section"><h2 class="title sectiontitle">Couchbase Server node statistics</h2><p class="p">Detailed stats documentation can be found in the
        repository.</p>
<p class="p">Along with stats at the REST and UI level, individual nodes can also be
        queried for statistics either through a client which uses binary protocol or through the
          cbstats utility.</p>
<p class="p">For
        example:</p>
<pre class="pre codeblock"><samp class="ph codeph">&gt; cbstats localhost:11210 all
 auth_cmds:                   9
 auth_errors:                 0
 bucket_conns:                10
 bytes_read:                  246378222
 bytes_written:               289715944
 cas_badval:                  0
 cas_hits:                    0
 cas_misses:                  0
 cmd_flush:                   0
 cmd_get:                     134250
 cmd_set:                     115750
…
</samp></pre>
<p class="p">The
        most commonly needed statistics are surfaced through the Web Console and have descriptions
        there and in the associated documentation. Software developers and system administrators
        wanting lower level information have it available through the stats interface.</p>
<p class="p">There
        are seven commands available through the stats interface:</p>
<ul class="ul">
        <li class="li"><p class="p"><samp class="ph codeph">stats</samp> (referred to as ‘all’)</p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">dispatcher</samp></p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">hash</samp></p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">tap</samp></p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">timings</samp></p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">vkey</samp></p>
</li>

        <li class="li"><p class="p"><samp class="ph codeph">reset</samp></p>
</li>

      </ul>
</div>

    <div class="section"><h2 class="title sectiontitle">stats command</h2><p class="p">This displays a large list of statistics related to the
        Couchbase process including the underlying engine (ep_* stats).</p>
</div>

    <div class="section"><h2 class="title sectiontitle">dispatcher command</h2><p class="p">This statistic shows what the dispatcher is
        currently
        doing:</p>
<pre class="pre codeblock"><samp class="ph codeph">dispatcher
     runtime: 45ms
       state: dispatcher_running
      status: running
        task: Running a flusher loop.
nio_dispatcher
       state: dispatcher_running
      status: idle
</samp></pre>
<p class="p">The
        first entry, dispatcher, monitors the process responsible for disk access. The second entry
        is a non-IO (non disk) dispatcher. There may also be a ro_dispatcher present if
        the engine is allowing concurrent reads and writes. When a task is actually running on a
        given dispatcher, the “runtime” tells you how long the current task has been running. Newer
        versions will show you a log of recently run dispatcher jobs so you can see what’s been
        happening.</p>
</div>

    
    <div class="section"><h2 class="title sectiontitle">Changing statistics collection</h2>
      <p class="p">The default Couchbase Server statistics
        collection is set to collect every second. The tuning that is available for statistic
        collection is by collecting statistics less frequently. </p>

      <div class="note note"><span class="notetitle">Note:</span> If statistic
        collection is changed from the default, the Couchbase service must be restarted.</div>

      
      <p class="p">To change statistic collection:</p>
<ol class="ol">
        <li class="li">Log in as root or sudo and navigate to the directory where Couchbase is installed. For
          example: <samp class="ph codeph">/opt/couchbase/etc/couchbase/static_config</samp></li>

        <li class="li">Edit the static_config file.</li>

        <li class="li">Add the following parameter: <samp class="ph codeph">grab_stats_every_n_ticks, 10</samp>, where 10 is the number of
          ticks. In the Couchbase environment one tick is one second (default). It is recommended
          that the statistics collection be more frequent (and accurate). However, assign an
          appropriate tick value for you environment.</li>

        <li class="li">Restart the Couchbase service.</li>

      </ol>
<p class="p">After restarting the Couchbase service, the statistics collection rate is changed.</p>
</div>

    
    <div class="section"><h2 class="title sectiontitle">Changing the stats file location</h2><p class="p">The default stats
          file location is <samp class="ph codeph">/opt/couchbase/var/lib/couchbase/stats</samp>, however, if you
          want to change the default stats file location, create a symlink location to the new
          directory.</p>

      <div class="note note"><span class="notetitle">Note:</span> When creating a symlink, stop and restart the Couchbase
          service. </div>
</div>

  </div>

  <nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Monitoring/monitor-intro.html" title="プロセス、ポート、キューなど、Couchbase Serverをモニタリングするためのさまざまな方法があります。">モニタリング</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Monitoring/monitor-diskqueue.html" title="Disk writing is implemented as a 2-queue system: commit to DRAM and then queued to be written to disk">Disk write queue</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Monitoring/monitor-moxi-statistics.html" title="Regular memcached clients can request statistics through the memcached stats command.">Couchbase Server Moxi statistics</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../REST/overview-rest-api.html" title="Use the REST API to manage clusters, server nodes, and buckets, and to retrieve run-time statistics within a Couchbase Server deployment.">REST API overview</a></div>
<div><a class="link" href="../CLI/cbstats-intro.html" title="The cbstats tool is used to get node and cluster-level statistics about performance and items in storage.">cbstats tool</a></div>
<div><a class="link" href="http://github.com/membase/ep-engine/blob/master/docs/stats.org" target="_blank">Detailed stats documentation</a></div></div>
</nav>

</body>
</html>