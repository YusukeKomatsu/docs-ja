<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="topic">
<meta name="description" content="Rebalancing operation is performed to expand or reduce the size of a cluster, to react to fail-overs, or to temporary remove nodes for various upgrades."><meta name="DC.Relation" scheme="URI" content="../Tasks/tasks-rebalance.html">
<meta name="DC.Relation" scheme="URI" content="../Tasks/rebalance-performing.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="topic1284">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Rebalancing operation</title>
</head>
<body id="topic1284">


  <h1 class="title topictitle1">Rebalancing operation</h1>

  
  
  <div class="body"><p class="shortdesc">Rebalancing operation is performed to expand or reduce the size of a cluster, to react
    to fail-overs, or to temporary remove nodes for various upgrades.</p>

   <div class="p">During the rebalance operation:
    <ul class="ul">
      <li class="li"><p class="p">Using the new Couchbase Server cluster structure, data is moved between the vBuckets on
        each node from the old structure. This process works by exchanging the data held in vBuckets on
        each node across the cluster. This has two effects:</p>

        <ul class="ul">
          <li class="li"><p class="p">Removes the data from the machines removed from the cluster. By totally removing the
            storage of data on these machines, it permits for each removed node to be taken out of the
            cluster without affecting the cluster operation.</p>
</li>

          <li class="li"><p class="p">Adds data and enables new nodes so that they can serve information to clients. By moving
            active data to the new nodes, these nodes become responsible for the moved vBuckets and for
            servicing client requests.</p>
</li>

        </ul>
</li>

      <li class="li"><p class="p">Rebalancing moves both the data stored in RAM, and the data stored on disk. This applies to each 
        bucket and to each node within the cluster. The time taken for the move depends on the
        level of cluster activity and the amount of stored information.</p>
</li>

      <li class="li"><p class="p">During rebalancing the cluster remains up and continues to service and handle client requests.
            Updates and changes to the stored data during the migration process are tracked and will
            be updated and migrated with the data that existed when the rebalance was requested.</p>
</li>

      <li class="li"><p class="p">The current vBucket map, used to identify which nodes in the cluster are responsible for handling
            client requests, is updated incrementally as each vBucket is moved. The updated vBucket
            map is communicated to the Couchbase client libraries and to the enabled smart clients
            (such as Moxi), and allows clients to use the updated structure as the rebalance
            completes. This ensures that the new structure is used as soon as possible to help
            spread and even out the load during the rebalance operation.</p>
</li>

    </ul>
</div>

    <p class="p">Because the cluster stays up and active throughout the entire rebalancing process, clients can continue to
      store and retrieve information and do not need to be aware that a rebalance operation is taking
      place.</p>

    <p class="p">There are four primary reasons to perform a rebalance operation:</p>

    <ul class="ul">
      <li class="li"><p class="p">Adding nodes to expand the size of the cluster.</p>
</li>

      <li class="li"><p class="p">Removing nodes to reduce the size of the cluster.</p>
</li>

      <li class="li"><p class="p">Reacting to a failover situation, where you need to bring the cluster back to a healthy
        state.</p>
</li>

      <li class="li"><p class="p">Temporary removing one or more nodes to perform a software, operating system, or hardware
          upgrade.</p>
</li>

    </ul>

    <p class="p">Regardless of the immediate reason, the purpose of any rebalance is to bring up a cluster
      to a healthy state where the configured nodes, buckets, and replicas match the current state of
      the cluster.</p>

    
    
    
  </div>

<nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Tasks/tasks-rebalance.html" title="Rebalancing is the process of redistributing information across nodes.">Rebalancing</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Tasks/rebalance-performing.html" title="Rebalancing a cluster involves marking nodes to be added or removed from the cluster and performing the rebalance operation.">Performing a rebalance</a></div>
</div>
</nav>
</body>
</html>