<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="topic">
<meta name="description" content="Multi-threaded readers and writers provide multiple processes to simultaneously read and write data on disk. Simultaneous reads and writes increase disk speed and improve the read rate from disk."><meta name="DC.Relation" scheme="URI" content="../Concepts/concept-diskStorage.html">
<meta name="DC.Relation" scheme="URI" content="../Concepts/concept-doc-delete.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="topic5374">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Multiple readers and writers</title>
</head>
<body id="topic5374">


  <h1 class="title topictitle1">Multiple readers and writers</h1>

  
  
  <div class="body"><p class="shortdesc">Multi-threaded readers and writers provide multiple processes to simultaneously read
    and write data on disk. Simultaneous reads and writes increase disk speed and improve the read
    rate from disk. </p>

    
    <p class="p">Multiple readers and writers are supported to persist data on disk. For earlier versions of
      Couchbase Server, each server instance had only single disk reader and writer threads.</p>
 
      <p class="p">Disk
      speeds have now increased to the point where single read/write threads do not efficiently
      keep up with the speed of the disk hardware. The other problem caused by single read/write
      threads is that if you have a good portion of data on disk and not in RAM, you can experience a
      high level of cache misses when you request this data. </p>

     
     
     
    <div class="note note"><span class="notetitle">Note:</span> In a Couchbase Server cluster, earlier versions of Couchbase Server can 
      co-exist with higher versions of Couchbase Server. Pre-2.1 nodes remain with single readers and writer for the data bucket. 
      Post-2.1 nodes have multiple readers and writers. </div>
 
      
      <p class="p">
      When server nodes are upgraded, the multiple readers and writers setting is implemented with 
      bucket restart and warmup. In this case, install the new node, add it to the cluster, 
      and edit the existing bucket setting for readers and writers.</p>
 
      <p class="p">After rebalancing the cluster, 
      the new node performs reads and writes with multiple readers and writers and the data bucket 
      does not restart or go through a warmup. All existing preâ€“2.1 nodes remain with a single readers 
      and writers for the data bucket. As pre-2.1 nodes are upgraded and added to the cluster, 
      these new nodes automatically pick up the setting and use multiple readers and writers for the bucket.</p>



    
    <p class="p">The multi-threaded engine includes additional synchronization among threads that are accessing the 
      same data cache to avoid conflicts. To maintain performance while avoiding conflicts over data, 
      Couchbase Server uses a form of locking between threads and thread allocation among vBuckets with static partitioning.</p>
 
     <p class="p"> When Couchbase Server creates multiple reader and writer threads, the server assesses a range of vBuckets for 
      each thread and assigns each thread exclusively to certain vBuckets. 
      With this static thread coordination, the server schedules threads so that only a single reader and 
      single writer thread can access the same vBucket at any given time. 
      The image shows six pre-allocated threads and two data Buckets. 
      Each thread has the range of vBuckets that is statically partitioned for read and write access.</p>

    
    <img class="image" src="../images/threads_read_write.png" width="500">
    

  </div>


<nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Concepts/concept-diskStorage.html" title="Couchbase Server mainly stores and retrieves information for clients using RAM. At the same time, Couchbase Server eventually stores all data to disk to provide a higher level of reliability.">Disk storage</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Concepts/concept-doc-delete.html" title="Couchbase Server never deletes entire items from disk unless a client explicitly deletes the item from the database or the expiration value for the item is reached.">Document deletion</a></div>
</div>
</nav>
</body>
</html>