<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="reference">
<meta name="description" content="The cbrestore tool restores data from a file to an entire cluster or to a single bucket in the cluster."><meta name="DC.Relation" scheme="URI" content="../cli-intro.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbreset_password_tool.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbstats-intro.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbrestore-ddocs.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cli-incremental-restore.html">
<meta name="DC.Relation" scheme="URI" content="../CLI/cbrestore-tween-opsys.html">
<meta name="DC.Relation" scheme="URI" content="https://github.com/couchbase/couchbase-cli">
<meta name="DC.Relation" scheme="URI" content="../Install/hostnames.html">
<meta name="DC.Relation" scheme="URI" content="../UI/ui-views-editor.html">
<meta name="DC.Relation" scheme="URI" content="cbbackup_tool.html">
<meta name="DC.Relation" scheme="URI" content="cbtransfer_tool.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdbrestore-tool">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>cbrestore tool</title>
</head>
<body id="cdbrestore-tool">


  <h1 class="title topictitle1">cbrestore tool</h1>

  
  <div class="body refbody"><p class="shortdesc">The <samp class="ph codeph">cbrestore</samp> tool restores data from a file to an entire cluster or
    to a single bucket in the cluster. </p>

    <div class="section"><h2 class="title sectiontitle">Description</h2>
    
    <p class="p">Items that had been written to file on disk are restored to RAM.The
        <samp class="ph codeph">cbbackup</samp>, <samp class="ph codeph">cbrestore</samp>, and <samp class="ph codeph">cbtransfer</samp> tools
        do not communicate with external IP addresses for server nodes outside of a cluster. Backup,
        restore, or transfer operations are performed on data from a node within a Couchbase
        cluster. They only communicate with nodes from a node list obtained within a cluster. This
        also means that if Couchbase Server is installed with a default IP address, an external
        hostname cannot be used to access it.</p>

    <p class="p">The tool is in the following locations:</p>

    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
        
        
        <thead class="thead" align="left">
          <tr class="row">
            <th class="entry" valign="top" width="50%" id="d41694e49">Operating system</th>

            <th class="entry" valign="top" width="50%" id="d41694e52">Location</th>

          </tr>

        </thead>

        <tbody class="tbody">
          <tr class="row">
            <td class="entry" valign="top" width="50%" headers="d41694e49 ">Linux</td>

            <td class="entry" valign="top" width="50%" headers="d41694e52 "><samp class="ph codeph">/opt/couchbase/bin/cbrestore</samp></td>

          </tr>

          <tr class="row">
            <td class="entry" valign="top" width="50%" headers="d41694e49 ">Windows</td>

            <td class="entry" valign="top" width="50%" headers="d41694e52 "><samp class="ph codeph">C:\Program&nbsp;Files\Couchbase\Server\bin\cbrestore</samp></td>

          </tr>

          <tr class="row">
            <td class="entry" valign="top" width="50%" headers="d41694e49 ">Mac OS X</td>

            <td class="entry" valign="top" width="50%" headers="d41694e52 "><samp class="ph codeph">/Applications/Couchbase&nbsp;Server.app/Contents/Resources/couchbase-core/bin/cbrestore</samp></td>

          </tr>

        </tbody>

      </table>
</div>

    </div>

    
    <div class="section"><h2 class="title sectiontitle">CLI command and parameters</h2>
      
      <p class="p">Basic syntax for this command:</p>

      <pre class="pre codeblock">cbrestore [options] [backup-dir] [destination]</pre>

      
      
      
      <p class="p">Where:</p>
<ul class="ul">
        <li class="li">[options]<p class="p">Command options for <samp class="ph codeph">cbrestore</samp> are the same
            options for <samp class="ph codeph">cbtransfer</samp>.</p>
</li>

        <li class="li">[backup-dir]<p class="p">The backup directory for the source data. This is in the
            directory created by <samp class="ph codeph">cbbackup</samp> when performing the backup.</p>
</li>

        <li class="li">[destination]<p class="p">The destination bucket for the restored information.
            This is a bucket in an existing cluster. If restoring data to a single node in a
            cluster, provide the hostname and port of the node being restored to. If restoring an
            entire data bucket, provide the URL of one of the nodes within the cluster.</p>
</li>

      </ul>

      
      <div class="note important"><span class="importanttitle">Important:</span> Be sure to create the destination bucket before restoring the data.</div>

      
      <p class="p">The following are the command options:</p>

      
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. cbrestore options</span></caption>
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="50%" id="d41694e154">Parameters</th>

              <th class="entry" valign="top" width="50%" id="d41694e157">Description</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-h, –help</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Command line help.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-a, –add</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Used to not overwrite existing items in the destination. Use add instead of set.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-b BUCKET_SOURCE, --bucket-source=BUCKET_SOURCE</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Single named bucket from the backup directory to restore. If the backup
                directory only contains a signle bucket, then that bucket is automatically
                used.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-B BUCKET_DESTINATION, –bucket-destination=BUCKET_DESTINATION</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">When --bucket-source is specified, overrides the destination bucket name. This
                allow you to restore to a different bucket. Defaults to the same as the
                bucket-source.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">from-date=FROM_DATE</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Restore data from the date specified as yyyy-mm-dd. By default, all data from the very beginning is restored.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">to-date=TO_DATE</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Restore data until the date specified as yyyy-mm-dd. By default, all data collected is restored.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-i ID, –id=ID</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Transfer only items that match a vbucket ID.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-k KEY, –key=KEY</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Transfer only items with keys that match a regexp.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-n, –dry-run</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">No actual transfer. Just validate parameters, files, connectivity and
                configurations.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-u USERNAME, –username=USERNAME</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">REST username for source cluster or server node.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-p PASSWORD, –password=PASSWORD</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">REST password for cluster or server node.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-t THREADS, –threads=THREADS</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Number of concurrent workers threads performing the transfer. </td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-v, –verbose</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Verbose logging. More v's provide more verbosity. Max: -vvv.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e154 ">-x EXTRA, –extra=EXTRA</td>

              <td class="entry" valign="top" width="50%" headers="d41694e157 ">Provide extra, uncommon configuration parameters. Comma-separated key=val(key-val)* pairs.</td>

            </tr>

            
          </tbody>

        </table>
</div>

      <p class="p">The following are extra, specialized command options with the <samp class="ph codeph">cbrestore -x</samp>
        parameter.</p>

      
      
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 2. cbrestore -x options</span></caption>
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="50%" id="d41694e316">-x options</th>

              <th class="entry" valign="top" width="50%" id="d41694e319">Description</th>

            </tr>

            
          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">backoff_cap=10</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Maximum backoff time during the rebalance period.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">batch_max_bytes=400000</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Transfer this # of bytes per batch.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">batch_max_size=1000</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Transfer this # of documents per batch.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">cbb_max_mb=100000</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Split backup file on destination cluster if it exceeds the MB.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">conflict_resolve=1</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">By default, disable conflict resolution.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">data_only=0</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">For value 1, transfer only data from a backup file or cluster.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">design_doc_only=0</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">For value 1, transfer only design documents from a backup file or cluster. Default: 0.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">max_retry=10</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Max number of sequential retries if the transfer fails.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">mcd_compatible=1</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">For value 0, display extended fields for stdout output.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">nmv_retry=1</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">0 or 1, where 1 retries transfer after a NOT_MY_VBUCKET message. Default: 1.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">recv_min_bytes=4096</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Amount of bytes for every TCP/IP batch transferred.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">rehash=0</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">For value 1, rehash the partition id's of each item. 
                This is required when transferring data between clusters with
                different number of partitions, such as when transferring data from an
                Mac OS X server to a non-Mac OS X cluster.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">report=5</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Number batches transferred before updating progress bar in console.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">report_full=2000</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Number batches transferred before emitting progress information in console.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">seqno=0</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">By default, start seqno from beginning.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">try_xwm=1</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">Transfer documents with metadata. Default: 1. Value of 0 is only used when transferring
                from 1.8.x to 1.8.x.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d41694e316 ">uncompress=0</td>

              <td class="entry" valign="top" width="50%" headers="d41694e319 ">For value 1, restore data in uncompressed mode.</td>

            </tr>

          </tbody>

        </table>
</div>

    </div>

    
    <div class="section"><h2 class="title sectiontitle">Syntax</h2>
      <p class="p">The following is the basic syntax:</p>

      <pre class="pre codeblock">cbrestore [options] [backup-dir] [destination]</pre>

      
      
      <p class="p">The following are syntax examples:</p>

      
      <pre class="pre codeblock">
cbrestore /backups/backup-42 http://HOST:8091 \
  --bucket-source=default --from-date=2014-01-20 --to-date=2014-03-31
cbrestore /backups/backup-42 couchbase://HOST:8091 \
  --bucket-source=default
cbrestore /backups/backup-42 memcached://HOST:11211 \
  --bucket-source=sessions --bucket-destination=sessions2
			</pre>

      
      
    </div>

    
    
   
    
    
    
   
    
    
   
    
  </div>

  <nav class="related-links">
<ol class="olchildlinks">
<li class="link olchildlink"><a href="../CLI/cbrestore-ddocs.html">Restoring design documents</a><br>
Design documents are restored using the <samp class="ph codeph">design_doc_only=1</samp> option.</li>
<li class="link olchildlink"><a href="../CLI/cli-incremental-restore.html">Restoring incrementally</a><br>
Incremental restore operations are run by using the <samp class="ph codeph">cbrestore</samp> 			command-line tool.</li>
<li class="link olchildlink"><a href="../CLI/cbrestore-tween-opsys.html">Restoring from different operating systems</a><br>
Data is restored to an operating system that is different from the backup operating     system, using the <samp class="ph codeph">cbrestore</samp> tool with the <samp class="ph codeph">restore=1</samp>     option.</li>
</ol>

<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../cli-intro.html" title="Couchbase Server command-line interface (CLI) tools are provided to manage and monitor clusters, servers, vBuckets, XDCR, and so on.">CLI reference</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../CLI/cbreset_password_tool.html" title="The cbreset_password tool is used to reset an administrative or user read-only password.">cbreset_password tool</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../CLI/cbstats-intro.html" title="The cbstats tool is used to get node and cluster-level statistics about performance and items in storage.">cbstats tool</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="https://github.com/couchbase/couchbase-cli" target="_blank">Couchbase command-line tools GitHub repository</a></div>
<div><a class="link" href="../Install/hostnames.html" title="Each Couchbase Server's instance can have its own hostname.">Using hostnames</a></div>
<div><a class="link" href="../UI/ui-views-editor.html" title="The Views section lets you manage your development and production views.">Views</a></div>
<div><a class="link" href="cbbackup_tool.html" title="cbbackupツールは、稼働中の全クラスタ・全バケット・単一ノード・正常稼働中ノード上の単一バケット のコピーを作成します。">cbbackupツール</a></div>
<div><a class="link" href="cbtransfer_tool.html" title="The cbtransfer tool is used to transfer data between clusters and to/from files.">cbtransfer tool</a></div></div>
</nav>

</body>
</html>