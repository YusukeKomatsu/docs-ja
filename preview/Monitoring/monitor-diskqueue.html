<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="topic">
<meta name="description" content="Disk writing is implemented as a 2-queue system: commit to DRAM and then queued to be written to disk"><meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-intro.html">
<meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-port-access.html">
<meta name="DC.Relation" scheme="URI" content="../Monitoring/monitor-statistics.html">
<meta name="DC.Relation" scheme="URI" content="../UI/ui-server-nodes.html">
<meta name="DC.Relation" scheme="URI" content="monitor-statistics.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="topic2232">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Disk write queue</title>
</head>
<body id="topic2232">


  <h1 class="title topictitle1">Disk write queue</h1>

  
  <div class="body"><p class="shortdesc">Disk writing is implemented as a 2-queue system: commit to DRAM and then queued to be written to disk</p>

    <p class="p">Couchbase Server is a persistent database which means that part of monitoring the system is
      understanding how we interact with the disk subsystem.</p>

    <p class="p">Since Couchbase Server is an asynchronous system, any mutation operation is committed first
      to DRAM and then queued to be written to disk. The client is returned an acknowledgment almost
      immediately so that it can continue working. There is replication involved here too, but we’re
      ignoring it for the purposes of this discussion.</p>

    <p class="p">Disk writing is implemented as a 2-queue system and are tracked by the stats. The
      first queue is where mutations are immediately placed. Whenever there are items in that queue,
      our “flusher” (disk writer) comes along and takes all the items off of that queue, places them
      into the other one and begins writing to disk. Since disk performance is so dramatically
      different from RAM, new writes can be continuously accepted while the system is (possibly
      slowly) writing new ones to the disk.</p>

    <p class="p">The flusher will process 250k items at a time, then perform a disk commit and continue this
      cycle until its queue is drained. When it has completed everything in its queue, it will
      either grab the next group from the first queue or essentially sleep until there are more
      items to write.</p>

    
    <div class="section"><h2 class="title sectiontitle">Monitoring the disk write queue</h2>
      <p class="p">There are basically two ways to
        monitor the disk queue, at a high-level from the Web UI or at a low-level from the
        individual node statistics.</p>

      <ol class="ol">
        <li class="li">From the Web UI, click on Monitor Data Buckets and select the particular bucket that you
          want to monitor.</li>

        <li class="li">Click “Configure View” in the top right corner and select the “Disk Write Queue”
          statistic. Closing this window shows that there is a new mini-graph.</li>

      </ol>

      <p class="p">This graph is showing the Disk Write Queue for all nodes in the cluster. 
        To get a deeper view into this statistic, monitor each node individually using the ‘stats’ output. 
        The statistics to watch are <samp class="ph codeph">ep_queue_size</samp> (where new mutations are placed) and <samp class="ph codeph">flusher_todo</samp>
        (the queue of items currently being written to disk).</p>
</div>

  </div>

  
  <nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Monitoring/monitor-intro.html" title="プロセス、ポート、キューなど、Couchbase Serverをモニタリングするためのさまざまな方法があります。">モニタリング</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Monitoring/monitor-port-access.html">Port numbers and accessing different buckets</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Monitoring/monitor-statistics.html" title="Couchbase Server provides statistics at multiple levels throughout the cluster.">Couchbase Server statistics</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../UI/ui-server-nodes.html" title="The Server Nodes section shows statistics across the server nodes in the cluster.">Server Nodes</a></div>
<div><a class="link" href="monitor-statistics.html" title="Couchbase Server provides statistics at multiple levels throughout the cluster.">Couchbase Server statistics</a></div></div>
</nav>

</body>
</html>