<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference xml:lang="ja" id="rest-bucket-memory-quota">
  <title>bucketのメモリ割り当ての変更</title>
  <shortdesc>
    bucketのメモリ割り当てを増減するには、<codeph>POST /pools/default/buckets/newBucket</codeph> HTTPメソッドとURIと<codeph>ramQuotaMB</codeph>オプションを使用します。
  </shortdesc>

  <refbody>
    
    <section><title>説明</title>
      <p>
        bucketのramQuotaMBは現在のレベルから増減することが出来ます。
        しかしながら、増加には害はないですが、減少は適切なサイズで行われるべきです。
        bucketのramQuotaMBの減少はwatermarkよりも低くします。ramQuotaMBが小さすぎる場合、アイテムが予期せずに除外されます。
      </p>
      
      <note type="note">
        memcached bucketタイプでのramQuotaMBの変更にはいくつか既知の問題があります。
      </note>
      <note type="important">
        有効なbucket構成を変更する場合、既存の構成パラメータと変更した認証パラメータを指定してください。
      </note>
    </section>
    
    
    <section><title>シンタックス</title>
      <p>Curlリクエストシンタックス:</p>
      <codeblock>curl -X POST -u [admin]:[password] 
  -d ramQuotaMB=[value] -d authType=[none | sasl]
  -d proxyPort=[port] 
  http://[localhost]:8091/pools/default/buckets/[bucket-name]</codeblock>
    </section>
    
    <section><title>例</title>
      <p>Curlリクエスト例:</p>
      <codeblock>curl -X POST -u Administrator:password 
  -d ramQuotaMB=130 
  -d authType=none
  -d proxyPort=11215 
  http://10.5.2.117:8091/pools/default/buckets/newBucket</codeblock>
     </section>
    
    
    <section><title>レスポンス</title>
      <p>
        202レスポンスは割り当てがクラスタ内のサーバ全体で非同期で変更されることを表しています。
      </p>
      <codeblock>HTTP/1.1 202 OK
Server: Couchbase Server 1.6.0
Pragma: no-cache
Date: Wed, 29 Sep 2010 20:01:37 GMT
Content-Length: 0
Cache-Control: no-cache no-store max-age=0
</codeblock>
        
        <p>もしRAM割り当てが少なすぎる場合、エラーと利用状況概要を返します:</p>
        <codeblock>{
    "errors": {
        "ramQuotaMB": "RAM quota cannot be less than 100 MB"
    }, 
    "summaries": {
        "hddSummary": {
            "free": 46214973056, 
            "otherBuckets": 16839602, 
            "otherData": 10095646158, 
            "thisUsed": 26456826, 
            "total": 56327458816
        }, 
        "ramSummary": {
            "free": 242221056, 
            "nodesCount": 1, 
            "otherBuckets": 268435456, 
            "perNodeMegs": 25, 
            "thisAlloc": 26214400, 
            "thisUsed": 33911144, 
            "total": 536870912
        }
    }
}</codeblock>
    </section>
    
    
    <section><title>レスポンスコード</title>
        <codeblock>202 OK</codeblock>
    </section>

  </refbody>
</reference>
