<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="reference">
<meta name="description" content="Dynamic shared thread pool performance is tunable via cbepctl set flush_param command options."><meta name="DC.Relation" scheme="URI" content="../../CLI/cbepctl-intro.html">
<meta name="DC.Relation" scheme="URI" content="../../CLI/CBepctl/cbepctl-thresholds.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cbepctl-threadpool-tuning">
<link rel="stylesheet" type="text/css" href="../../commonltr.css">
<title>Changing shared thread pool settings</title>
</head>
<body id="cbepctl-threadpool-tuning">


  <h1 class="title topictitle1">Changing shared thread pool settings</h1>

  
  <div class="body refbody"><p class="shortdesc">Dynamic shared thread pool performance is tunable via <samp class="ph codeph">cbepctl set flush_param</samp> command options.</p>

    <div class="section"><h2 class="title sectiontitle">Description</h2>
      <p class="p">The dynamic shared thread pool performance is tunable by changing the thread types inside
        the ep-engine and memcached at run time. <samp class="ph codeph">cbepctl set flush_param</samp> command
        options adjust the number of threads that prioritize read, write, non-i/o and auxiliary-i/o
        operations. These settings take effect immediately and do not require that the bucket be
        restarted. </p>

        
      <div class="note note"><span class="notetitle">Note:</span> These settings only take effect if the underlying operating system has a
        sufficient number of CPU cores. The minimum number of CPU cores is four (4), however,  
        three (3) additional cores are required for each additional writer thread. 
        For example, five (5) writer threads is a valid setting if the underlying hardware has at least 
        sixteen (16) cores.</div>

    
      
      <p class="p">The following are the command option parameters used for performance tuning:</p>

      
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. Performance tuning parameters</span></caption>
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="50%" id="d13064e49">Parameter</th>

              <th class="entry" valign="top" width="50%" id="d13064e52">Description</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d13064e49 ">max_num_readers</td>

              <td class="entry" valign="top" width="50%" headers="d13064e52 ">Overrides the default number of global threads that prioritize read operations.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d13064e49 ">max_num_writers</td>

              <td class="entry" valign="top" width="50%" headers="d13064e52 ">Overrides the default number of global threads that prioritize write operations.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d13064e49 ">max_num_auxio</td>

              <td class="entry" valign="top" width="50%" headers="d13064e52 ">Overrides the default number of global threads that prioritize auxio operations.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="50%" headers="d13064e49 ">max_num_nonio</td>

              <td class="entry" valign="top" width="50%" headers="d13064e52 ">Overrides the default number of global threads that prioritize nonio operations.</td>

            </tr>

          </tbody>

        </table>
</div>

      
    </div>

    
    <div class="section"><h2 class="title sectiontitle">Syntax</h2>
      <p class="p">The following is the basic syntax:</p>

      <pre class="pre codeblock">cbepctl [localhost]:11210 -b [bucket-name] set flush_param [parameter] [value]</pre>


    </div>

    
    <div class="section"><h2 class="title sectiontitle">Example</h2>
      <p class="p">To set the maximum number of writers, use <samp class="ph codeph">max_num_writers</samp> parameter. 
        In the following example, <samp class="ph codeph">max_num_writers</samp> sets the number of writer threads to five (5).</p>

      <pre class="pre codeblock">cbepctl 10.5.2.117:11210 -b foo_bucket set flush_param max_num_writers 5 </pre>

      
      
      
    </div>

    
    <div class="section"><h2 class="title sectiontitle">Response</h2>
      <p class="p">The following is an example response when setting the maximum number of writer threads.</p>

      <pre class="pre codeblock">
setting param: max_num_writers 5
set max_num_writers to 5
      </pre>

      
      
      <p class="p">To check how many threads of various types are currently running, use <samp class="ph codeph">cbstats workload</samp>. 
        For example:</p>

      <pre class="pre codeblock">cbstats [localhost]:11210 -b [bucket-name] workload </pre>

      
      <p class="p">For example, the following shows an example request and response for <samp class="ph codeph">cbstats
          workload</samp>, in this case, for the default bucket. The setting change,
          <samp class="ph codeph">ep_workload:max_writers: 5</samp>, is displayed via the <samp class="ph codeph">cbstats
          workload</samp> response: </p>

      
      <pre class="pre codeblock">
cbstats 10.5.2.117:11210 workload

 ep_workload:LowPrioQ_AuxIO:InQsize:   2
 ep_workload:LowPrioQ_AuxIO:OutQsize:  0
 ep_workload:LowPrioQ_NonIO:InQsize:   18
 ep_workload:LowPrioQ_NonIO:OutQsize:  0
 ep_workload:LowPrioQ_Reader:InQsize:  8
 ep_workload:LowPrioQ_Reader:OutQsize: 0
 ep_workload:LowPrioQ_Writer:InQsize:  12
 ep_workload:LowPrioQ_Writer:OutQsize: 0
 ep_workload:max_auxio:                1
 ep_workload:max_nonio:                1
 ep_workload:max_readers:              4
 ep_workload:max_writers:              5
 ep_workload:num_auxio:                1
 ep_workload:num_nonio:                1
 ep_workload:num_readers:              4
 ep_workload:num_shards:               4
 ep_workload:num_sleepers:             10
 ep_workload:num_writers:              5
 ep_workload:ready_tasks:              0
      </pre>

      
    </div>

    
    
  </div>

<nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../CLI/cbepctl-intro.html" title="The cbepctl tool is used to control vBucket states, configuration, and memory and disk persistence behavior.">cbepctl tool</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../CLI/CBepctl/cbepctl-thresholds.html" title="The item pager process ejects items from RAM when too much space is being taken up in RAM.">Changing ejection thresholds</a></div>
</div>
</nav>
</body>
</html>