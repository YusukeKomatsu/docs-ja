<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="ja">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="topic">
<meta name="description" content="vBucketはCouchbaseクラスタにおけるキー空間のサブセットの所有者を定義します。 vBucketはクラスタ内で効率的に情報を分散するために利用されます。"><meta name="DC.Relation" scheme="URI" content="../Concepts/concept-intro.html">
<meta name="DC.Relation" scheme="URI" content="../Concepts/concept-ramQuota.html">
<meta name="DC.Relation" scheme="URI" content="../Concepts/concept-cacheLayer.html">
<meta name="DC.Relation" scheme="URI" content="concept-rebalancing.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="topic2955">
<meta name="DC.Language" content="ja">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>vBuckets</title>
</head>
<body id="topic2955">


  <h1 class="title topictitle1">vBuckets</h1>

  
  <div class="body"><p class="shortdesc">
	  vBucketはCouchbaseクラスタにおけるキー空間のサブセットの<em class="ph i">所有者</em>を定義します。
	  vBucketはクラスタ内で効率的に情報を分散するために利用されます。
  </p>

	  <p class="p">
		  vBucketシステムは、1つ以上のノードによるデータの分散と、レプリカ(バケットデータのコピー)を実現するために利用されます。
		  vBucketはユーザがアクセス可能なコンポーネントではありませんが、Couchbase Serverの重要なコンポーネントであり、
		  可用性と伸縮性のために非常に重要です。
      </p>

	  <p class="p">
		  クライアントはvBucketを担当するノードに直接接続して、バケットに保存された情報にアクセスします。
		  プロキシや再配布のアーキテクチャを利用せず、データを保持するノードに直接接続します。
		  結果として、物理的なトポロジを、論理的なデータパーティションから分離します。
		  このアーキテクチャが、Couchbase Serverに伸縮性と柔軟性をもたらしています。
      </p>

	  <p class="p">
		  すべてのドキュメントIDはvBucketに属しています。マッピング関数によって、ドキュメントがどのvBucketに属するのかを計算できます。
		  Couchbase Serverではこのマッピング関数はハッシュ関数であり、ドキュメントIDを入力としてvBucketのIDを出力します。
		  vBucketのIDを計算したあと、そのvBucketを"ホスト"するサーバを、テーブルから参照します。
		  このテーブルはvBucketごとに行があり、vBucketとそのホストサーバを関連付けています。
		  このテーブル内で定義されている各サーバは通常、複数のvBucketを担当します。
      </p>

    
	  <p class="p">以下の図はキーがサーバにマッピングされている様子(vBucketマップ)を示しています。</p>

    
	  <p class="p">
		  このシナリオでは、クラスタ内に3台のサーバがあり、クライアントがKEYのバリューを<samp class="ph codeph">GET</samp>操作により参照しようとしています。
      </p>

    
    <ol class="ol">
		<li class="li">
			クライアントはまず、キーをハッシュ化して、KEYが所属するvBucketを計算します。
			この例では、ハッシュの結果、vBucket 8(vB8)となります。
        </li>

		<li class="li">
			vBucketマップを参照し、クライアントはサーバCがvB8をホストしていることを知ります。
        </li>

		<li class="li">
			クライアントは<samp class="ph codeph">GET</samp>操作を直接サーバCに送信します。
		</li>

    </ol>

    
      <img class="image" src="../images/vbuckets.png" width="500">
    
	  <p class="p">
		次のシナリオでは、3台のクラスタに新しくサーバを追加しています。
		新規のサーバDがクラスタに参加すると、リバランス操作によって、vBucketマップが更新されます。
		更新されたマップは、クラスタ内のその他のノード、すべての接続中の"スマート"クライアント、Moxiプロキシサーバといった、
		クラスタに接続するすべてのオブジェクトに送信されます。
		</p>

    
		<p class="p">4台のクラスタとなったあと、クライアントが再度KEYのバリューを<samp class="ph codeph">GET</samp>操作により取得すると:</p>

    <ul class="ul">
		<li class="li">ハッシュアルゴリズムは依然としてvBucket 8(vB8)を出力します。</li>

		<li class="li">更新されたvBucketマップはvBucket 8をサーバDにマッピングしています。</li>

		<li class="li">クライアントは<samp class="ph codeph">GET</samp>操作を直接サーバDに送信します。</li>

    </ul>

    
    <img class="image" src="../images/vbuckets-after.png" width="500">
    
	<div class="note note"><span class="notetitle">注:</span> 
		このアーキテクチャによりCouchbase Serverは、典型的なRDBMSのシャーディング方式を利用せず変化に対応できます。
		また、<samp class="ph codeph">memcached</samp>が採用している、クライアント側でキーをハッシュし、定義されたリストからサーバを特定する方式とも異なります。
		memcachedの方式は、トポロジの変化に対応するために、サーバリストの継続的管理が必要であり、Ketamaなどの特定のハッシュアルゴリズムが必要になります。
	</div>

    
  
    
  </div>

  
  <nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>親トピック:</strong> <a class="link" href="../Concepts/concept-intro.html" title="単一のCouchbase ServerインスタンスやCouchbaseクラスタを構成する、さまざまなコンポーネントやシステム、そしてCouchbase Serverデータベースの高速でエラスティックな性質、高可用性、高性能について理解するために必要となる情報や概念を含んでいます。">アーキテクチャと概念</a></div>
<div class="previouslink"><strong>前のトピック:</strong> <a class="link" href="../Concepts/concept-ramQuota.html" title="RAMはCouchbase Serverに次の割当量として設定されます: サーバ割当量とバケット割当量">RAM割当量</a></div>
<div class="nextlink"><strong>次のトピック:</strong> <a class="link" href="../Concepts/concept-cacheLayer.html" title="Couchbase Server includes a built-in caching layer which acts as a central part of the server and provides very rapid reads and writes of data.">Caching layer</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="concept-rebalancing.html" title="Rebalancing operation is performed to expand or reduce the size of a cluster, to react to fail-overs, or to temporary remove nodes for various upgrades.">Rebalancing operation</a></div></div>
</nav>

</body>
</html>