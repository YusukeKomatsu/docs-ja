<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2015">
<meta name="DC.rights.owner" content="(C) Copyright 2015">
<meta name="DC.Type" content="concept">
<meta name="description" content="ラックアウェアネス機能は、ラックやアベイラビリティゾーンにそれぞれのサーバグループが物理的に属しているクラスタにおける、論理的グループを可能にします。"><meta name="DC.Relation" scheme="URI" content="../Concepts/concept-clusterMgr.html">
<meta name="DC.Relation" scheme="URI" content="../Concepts/concept-nodesCluster.html">
<meta name="DC.Relation" scheme="URI" content="../Tasks/rza-manage-group.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="concept_exs_rrg_rn">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>ラックアウェアネス</title>
</head>
<body id="concept_exs_rrg_rn">


 <h1 class="title topictitle1">ラックアウェアネス</h1>

 
  
  <div class="body conbody"><p class="shortdesc">ラックアウェアネス機能は、ラックやアベイラビリティゾーンにそれぞれのサーバグループが物理的に属しているクラスタにおける、論理的グループを可能にします。</p>

   <div class="note attention"><span class="attentiontitle">Attention:</span> この機能はエンタープライズエディションのみで利用可能です。</div>

   <p class="p">ラックアウェアネスはアクティブなパーティションと対になるレプリカのパーチションが、異なるラックあるいはゾーネに所属するサーバ上に生成されるように指示することができます。
ラックアウェアネスを有効化して利用するには、クラスタ内のすべてのサーバをCouchbase Serverエンタープライズエディションのバージョン2.5移行にアプグレードする必要があります。
設計上、Couchbase Serverはクラスタの性能と冗長性を目的として、アクティブとレプリカのvBucketデータをクラスタ内で均一に分散します。
ラックアウェアネスを利用すると、一つ目のサーバグループに所属するサーバのレプリカパーティションが、二つ目のグループに分散されるよう、サーバパーティションを配置します。逆もまた然りで、二つ目のグループのレプリカを一つ目のグループに配置します。
もしサーバのひとつが利用不可となるか、あるいはラック全体がダウンしてしまっても、レプリカは二つ目のサーバグループで利用可能であるため、データは保持されます。
  </p>

  <p class="p">レプリカvBucketは冗長性とデータの可用性を高めるため、一つ目のサーバグループからもう一方のサーバグループへと等しく分散されます。
リバランス操作もまた、レプリカvBucketを一つ目のサーバグループからクラスタ内のもう一方のサーバグループへと均一に分散します。
もしあるサーバグループ内のサーバ台数が異なり、不均等な状態となると、リバランス操作は「ベストエフォート」としてレプリカvBucketがクラスタ内で均等に分散されるように処理します。
</p>

  <div class="section"><h2 class="title sectiontitle">vBucketの分散とレプリカvBucket</h2>
   
   <p class="p">以下の例では、ラックアウェアネスがどのように機能し、レプリカvBucketにより冗長性を実装しているのかを示しています。
この例では、クラスタ内に二つのサーバグループが存在し、4つのサーバがそれぞれのサーバグループに存在します。
各サーバグループ内のサーバ台数が等しいので、クラスタはバランスがとれており、片方のサーバグループのレプリカvBucketがもう一方のサーバグループ上にあることを保証します。</p>

   <p class="p">以下の図はラック#1とラック#2の二つのラックに、それぞれ4台ずつのサーバを配置したクラスタを示しています。
</p>

    <ul class="ul">
     <li class="li">グループ1にはサーバ1、2、3、4。</li>

     <li class="li">グループ1は自身のアクティブvBucketと、グループ2のレプリカvBucketを保持。 </li>

     <li class="li">グループ2にはサーバ5、6、7、8。</li>

     <li class="li">グループ2は自身のアクティブvBucketと、グループ1のレプリカvBucketを保持。</li>

    </ul>


   <div class="fig fignone"><span class="figcap">Figure 1. ラックアウェアネス</span>
    <img class="image" src="../images/RZASimple.png" width="680"></div>
 
  </div>

  
  <div class="section"><h2 class="title sectiontitle">サーバ追加による分散</h2>
   
   <p class="p">以下のシナリオはラックアウェアネスが、ひとつのサーバグループにサーバを追加することで不均等な状態になった際に、どのようにレプリカvBucketを実装しているかを示しています。
この例では、サーバグループ1にサーバ9を追加しています。
あるサーバグループが他のサーバグループよりも多くのサーバを所持しているため、不均等な状態となります。
この場合、リバランス操作は「ベストエフォート」として、追加されたサーバのレプリカvBucketをクラスタ内のすべてのラックに属するノードに均等に分散するよう動作します。
</p>

   <p class="p">以下の図はラック#1とラック#2の二つのラックで、ひとつのラックには5台のサーバ、もう一方には4台のサーバを配置したクラスタを示しています。
</p>

   <ul class="ul">
     <li class="li">グループ1にはサーバ1、2、3、4、そして9。</li>

     <li class="li">グループ1は自身のアクティブvBucketと、グループ2のレプリカvBucketを保持。 </li>

    <li class="li">グループ1のサーバ1-4は、サーバ9のレプリカvBucketも保持する</li>

     <li class="li">グループ2にはサーバ5、6、7、8。</li>

     <li class="li">グループ2のサーバは自身のアクティブvBucketと、サーバ9を含むグループ1のvBucketを保持。
</li>
  
   </ul>

   
   <div class="fig fignone"><span class="figcap">Figure 2. サーバ追加時のラックアウェアネス</span>
    <img class="image" src="../images/RZAServerIN.png" width="680"></div>

  </div>

  
  <div class="section"><h2 class="title sectiontitle">サーバ障害と分散</h2>
   
   <p class="p">以下のシナリオでは、ラックアウェアネスが、あるサーバグループのサーバが削除される、あるいは利用不可となった場合に、どのようにレプリカを実装しているのかを示しています。
この例では、グループ1に属するサーバ2が利用不可となっています。
あるサーバグループが他のサーバグループよりも少ないサーバ数であるため、不均等な状態が起きています。
この場合、リバランス操作を行うと、「ベストエフォート」として、レプリカvBucketをクラスタ全体で均等に分散するように動作します。
</p>

   
   <div class="note note"><span class="notetitle">Note:</span> 
クラスタが不均等になった場合、サーバを追加しクラスタのバランスをとってください。ラックアウェアネスが最適に動作するために、バランスのとれたクラスタを推奨します。サーバが1台しかない、もしくはサーバグループがひとつしかない場合、ラックアウェアネスを利用しないデフォルトの動作となります。
   </div>

   
   <p class="p">以下の図はサーバの消失によって不均等となった様子を示しています。
この例では、サーバ2(グループ1、ラック#1)が利用不可となっています。
ラック#2のグループ2にあるサーバ2のレプリカvBucketが有効化され、クラスタは不均等な状態になります。
</p>

   <ul class="ul">
     <li class="li">グループ1にはサーバ1、2、3、4。</li>

    <li class="li">グループ1のサーバは自身のアクティブvBucketとグループ2のレプリカvBucketを保持。
</li>

    <li class="li">グループ1のサーバ2が利用不可に。</li>

     <li class="li">グループ2にはサーバ5、6、7、8。</li>

    <li class="li">グループ2のサーバは自身のアクティブvBucketとグループ1のレプリカvBucketを保持。
</li>

    <li class="li">グループ2のサーバは、グループ1、サーバ2のレプリカvBucketをアクティブ化。</li>
  
   </ul>

   
   <div class="fig fignone"><span class="figcap">Figure 3. サーバ障害とラックアウェアネス</span>
    <img class="image" src="../images/RZAServerOUT.png" width="680"></div>

  </div>

 
 </div>

 <nav class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Concepts/concept-clusterMgr.html" title="クラスタマネージャはノードとクラスタの管理を担当します。Couchbaseクラスタ内のすべてのノードはクラスタマネージャコンポーネントを有しています。">クラスタマネージャ</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Concepts/concept-nodesCluster.html" title="Couchbase Serverはスタンドアロンでも、クラスタ構成でも利用できます。クラスタとは複数のCouchbase Serverが相互に接続することにより一つの分散データストアを構成することです。">ノードとクラスタ</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../Tasks/rza-manage-group.html" title="The Rack Awareness feature (Enterprise Edition) enables logical groupings of servers on a cluster where each server group physically belongs to a rack or availability zone. This feature provides the ability to specify that active and corresponding replica partitions be created on servers that are part of a separate rack or zone.">Managing Rack Awareness</a></div></div>
</nav>

</body>
</html>